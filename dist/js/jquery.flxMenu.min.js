!function(O){O.fn.flxMenu||(O.fn.flxMenu=function(e,a){var r={puTop:0,puLeft:1,puRight:2},i={fnChanged:function(e,i,n){c(!0,"Moved bar from {1} to {0}",i[0].id,n[0].id)},fnInit:function(e,i){},fnSubmenuClosing:function(e){c(!0,'closing submenu of <{0} id="{1}">',e[0].nodeName,e.attr("id"))},fnPopupShowing:function(e){c(!0,"Popup showing {0} ",e)},duration:300,orientation:"horizontal",smShowByClick:!1,puSlideInFrom:"top",puCloseOnSelect:!1,puShowActiveItem:!1,puAligned:!1,puFullRange:!0,puAutoWidth:!1,smFilterClass:!1,framework:!1,debug:!1};function u(e,i){c(!0,"DoNothing called on "+i.attr("id"))}function f(e,i){$li=O(e.target).closest("li"),$li.is(i)&&v(i,1),e.stopPropagation()}function d(e,i){e.preventDefault(),v(i)}function h(e,i){e.preventDefault(),g(i)}if(O.fn.flxLog||(a.debug&&console.log('flxMenu: !!! load "debug.js" for logging outputs !!!'),O.fn.flxLog=function(){}),0==this.length)return c(!0,'No element found for "'+this.selector+'".'),this;if(1<this.length)return c(!0,'Found more than one element for "'+this.selector+'".'),c(!0,'Only handle the first: "'+this[0].id+'".'),O(this[0]).flxMenu(e,a),this;if(!this.data("flxMenu")){this.data("flxMenu",!0);a=O.extend({},i,a||{});return this.addClass("flxMenu"),function(e,i){c(a.debug,"init with options: {0}",a),e.target=i[0],"top"!=a.puSlideInFrom&&(a.puAligned=!1);var n=i.children("a").first();if(0<n.length)n.hasClass("flxMenuToggle")?(n.click(function(){O(this).trigger("menuToggle")}),a.puAligned=!0):(n.addClass("flxMenuOpen"),n.click(function(){O(this).trigger("menuShow")}));else{var t="";t=a.img?'<img class="menuSymbol" src="'+a.img+'" />':'<ul class="menuSymbol"><li></li><li></li><li></li></ul>',a.puAligned?(n=O('<a href="javascript:" class="flxMenuToggle">'+t+"</a>")).click(function(){O(this).trigger("menuToggle")}):(n=O('<a href="javascript:" class="flxMenuOpen">'+t+"</a>")).click(function(){O(this).trigger("menuShow")}),i.prepend(n)}if(0==i.children(".menuFrame").length){var s="";n.hasClass("flxMenuToggle")||(s='<a href="javascript:" title="close" class="menuClose" onclick="$(this).trigger(\'menuClose\')"> </a>');var o='<div class="menuFrame"><div class="menuSlider">'+s+"</div></div>";i.append(O(o))}e.id||(e.id="flxMenu");var l=O(e);$menuButtons=l.find("a"),$menuButtons.on("keydown",function(e){var i=p(O(this));switch(c(i.debug,"keydown code {1} on {0}",O(this).text(),e.which),e.which){case 27:e.preventDefault(),O(this).trigger("menuClose");break;case 13:$Li=O(this).closest("li"),$Li.hasClass("hasSubmenu")&&(e.preventDefault(),v($Li));break;case 40:e.preventDefault(),$Li=O(this).closest("li");var n=[];if("left"==(s=$Li.css("float"))||"right"==s)$Li.hasClass("hasSubmenu")&&(v($Li),n=$Li.find("li:first"));else if(0==(n=$Li.next()).length){if(0==(n=x($Li.parent(),$Li,i)).length)break;if("left"==(s=n.css("float"))||"right"==s)break}else i.popup||g($Li);0<n.length&&n.find("a:first").focus();break;case 38:if(e.preventDefault(),$Li=O(this).closest("li"),"left"==(s=$Li.css("float"))||"right"==s){$Li.hasClass("displaySubmenu")&&g($Li);break}0==(n=$Li.prev()).length?n=x($Li.parent(),$Li,i,!0):i.popup||g($Li),0<n.length&&n.find("a:first").focus();break;case 37:if(e.preventDefault(),$Li=O(this).closest("li"),$Li.hasClass("displaySubmenu")){g($Li);break}if(n=[],"left"==(s=$Li.css("float")))n=$Li.prev();else if("right"==s)n=$Li.next();else{var t=$Li.parent();0==(n=b(t,$Li.offset(),i)).length&&(n=t.closest("li"))}0<n.length&&n.find("a:first").focus();break;case 39:var s;e.preventDefault(),$Li=O(this).closest("li"),n=[],0<(n="left"==(s=$Li.css("float"))?(i.popup||g($Li),$Li.next()):"right"==s?(i.popup||g($Li),$Li.prev()):$Li.hasClass("hasSubmenu")?(v($Li,39),$Li.find("li:first")):b($Li.parent(),$Li.offset(),i,!0)).length&&n.find("a:first").focus()}}),"lyraT4"==a.framework&&window.editPermissions&&(c(a.debug,'setting "smShowByClick" in lyraT4 edit mode'),a.smShowByClick=!0),a.puCloseOnSelect&&$menuButtons.on("click",function(){O(this).closest("li").hasClass("hasSubmenu")||O(this).trigger("menuClose")});var r=a.initialFrame;r&&0!=r.length||(c(a.debug,'build elemFrame around "{0}"',e.id),l.wrap('<div id="flxFrame'+e.id+'"></div>'),r=O(e).parent()),e.initialFrame=r[0],r.addClass("flxInitFrame"),"vertical"==a.orientation&&r.addClass("flx-vertical"),l.find("li").each(function(){var i=O(this);0<i.find("li").length&&(i.addClass("hasSubmenu"),i.on("click",function(e){l[0].onItemClick(e,i)}),i.on("mouseenter",function(e){l[0].onItemEnter(e,i)}),i.on("mouseleave",function(e){l[0].onItemLeave(e,i)}))}),i.addClass("menuTrigger"),"left"==a.puSlideInFrom?(i.on("menuClose",S).on("menuShow",$),i.addClass("flx-left")):"right"==a.puSlideInFrom?(i.on("menuClose",k).on("menuShow",L),i.addClass("flx-right")):i.on("menuClose",y).on("menuShow",w),i.on("menuToggle",function(){O(this).hasClass("showUp")?O(this).triggerHandler("menuClose"):O(this).triggerHandler("menuShow")}),l.on("flxMenuCheck",function(){var e=O(this.target);C(l,O(this.initialFrame),e.children(".menuFrame").children(".menuSlider"),e)}).on("flxMenuRegisterItem",function(e,i,n){var t,s;n?function(e,i){if(c(e.flxOptions.debug,"flxUnregisterItem"),i.parentNode==e)e.removeChild(i),e.flxOptions.puAutoWidth&&(F(e),O(e).triggerHandler("flxMenuCheck"));else{var n=i.parentNode;n.removeChild(i),n.hasChildNodes()||O(n).closest("li").removeClass("hasSubmenu")}}(this,i):(s=i,c((t=this).flxOptions.debug,"flxRegisterItem"),O(s).parentsUntil(t).filter("li").each(function(){var i=O(this);i.addClass("hasSubmenu"),i.on("click",function(e){t.onItemClick(e,i)}),i.on("mouseenter",function(e){t.onItemEnter(e,i)}),i.on("mouseleave",function(e){t.onItemLeave(e,i)})}),t.flxOptions.puAutoWidth&&s.parentNode==t&&(F(t),O(t).triggerHandler("flxMenuCheck")))}).on("flxMenuOptions",function(e,i){this.flxOptions=O.extend({},this.flxOptions,i),c(!0,'flxMenuOptions changed options: "{0}"',p(O(this)))}),O(window).on("resize",function(){O(e).trigger("flxMenuCheck")}),(e.flxOptions=a).puAutoWidth&&F(e),C(l,r,i.children(".menuFrame").children(".menuSlider"),i,!0),a.fnInit(l,r,i)}(this[0],e),this}function c(e,i,n,t,s,o,l,r,a,u){e&&O.fn.flxLog(i,n,t,s,o,l,r,a,u)}function p(e){return $root=e.closest(".flxMenu"),$root[0].flxOptions}function m(e){$frame=e.children("ul, div").first().css({overflow:"hidden",height:0}),e.removeClass("displaySubmenu")}function g(e,i){var n=p(e);"lyraT4"==n.framework&&window.editPermissions&&ltxCancelForm(),n.fnSubmenuClosing(e),e.removeClass("inProgrOpen"),e.children("ul, div").first().stop(!0,!1),i?(e.children("ul, div").first().css("overflow","hidden").animate({height:0},n.duration),e.removeClass("displaySubmenu"),e.find(".displaySubmenu").each(function(){var e=O(this);e.children("ul, div").first().css("overflow","hidden").animate({height:0},n.duration),e.removeClass("displaySubmenu")})):(m(e),e.find(".displaySubmenu").each(function(){m(O(this))})),O(document).off("click.flxMenu")}function v(i,e){if(!i.hasClass("hasSubmenu"))return!1;if(i.hasClass("displaySubmenu")&&1==e)return g(i,!0),!1;if(i.hasClass("inProgrOpen")||i.hasClass("displaySubmenu"))return!0;var n=p(i);i.siblings("li.displaySubmenu").each(function(){g(O(this),e)}),n.smShowByClick&&!n.popup&&O(document).on("click.flxMenu",function(e){O(e.target).closest(".flxInitFrame").length?console.log("clicked on item of mainMenu"):g(i,!0)});var t=i.children("ul, div"),s=O(t[0]);s.removeClass("leftAligned");var o=s.offset(),l=s.width(),r=s.css("min-width");s.css("position","fixed"),s.css("min-width",0),s.css("left",-9999),s.css("width",l),s.css("height","auto"),subH=s.outerHeight()+3,c(n.debug,"__flxOpenSubmenu - sub frame calculated h: {0}",subH),O(window).scrollLeft()+O(window).width()<o.left+l&&s.addClass("leftAligned"),s.css("position",""),s.css("left",""),s.css("height",0),s.css("width",""),s.css("min-width",r);var a=i.parent().closest(".displaySubmenu").children("ul, div");if(0<a.length){var u=O(a[0]);c(n.debug,"__flxOpenSubmenu - parent sub frame: <{0}>",a[0].nodeName),u.css("height","auto"),u.css("overflow","visible")}return i.addClass("inProgrOpen"),s.animate({height:subH+"px"},n.duration,function(){i.removeClass("inProgrOpen")}),i.addClass("displaySubmenu"),s}function C(e,i,n,t,s){var o=p(e);c(o.debug,"flxMenuCheckPosition({0}, {1}, {2})",e[0].id,i[0].id,n[0].id),c(o.debug,"- flxOptions.popup: {0}",o.popup);var l=!1;o.thW&&(c(o.debug,"- flxOptions.thW: {0}",o.thW),i.innerWidth()<o.thW?t.show():t.css("display","none")),"none"!=t.css("display")&&(l=!0),$Li=e.find("li"),$Li.each(function(){O(this).hasClass("displaySubmenu")&&m(O(this))}),l?o.popup&&!s||(e[0].onItemEnter=u,e[0].onItemLeave=u,e[0].onItemClick=f,t.show(),n.append(e),o.popup=!0,"lyraT4"==o.framework&&window.editPermissions&&(t.find(".ltxContainer").addClass("ltx-locked"),s||ltxCancelForm()),o.fnChanged(!0,t,i)):(t.removeClass("showUp"),t.children(".menuFrame").hide(),(o.popup||s)&&(o.smShowByClick?(e[0].onItemEnter=u,e[0].onItemLeave=u,e[0].onItemClick=f):(e[0].onItemEnter=d,e[0].onItemLeave=h,e[0].onItemClick=u),i.prepend(e),o.popup=!1,"lyraT4"==o.framework&&window.editPermissions&&t.find(".ltxContainer").removeClass("ltx-locked"),o.fnChanged(!1,i,t)),i.show(),$Li.first().find("a:first").focus())}function b(i,n,t,e){c(t.debug,"__flxFindTargetInFrame(<{0}>, {1}, {2})",i[0].nodeName,n,e);var s=i.parent();if(s.is("li"))return e?[]:s;var o=1;if(e&&(o=-1),$pFrameChildren=s.children().filter(function(){if(this==i[0])return c(t.debug,"remove element <{0}> from frame set",this.nodeName),!1;var e=O(this).offset().left;return!((n.left-e)*o<5)||(c(t.debug,"remove element <{0}> from frame set; left: {1} ",this.nodeName,e),!1)}),0<$pFrameChildren.length){var l=9999;return $target=[],$pFrameChildren.find("li").each(function(){var e=O(this).offset();if(c(t.debug,"compare <li> {0} with {1}",e,n),5<(n.left-e.left)*o){var i=Math.abs(n.top-e.top);i<l&&(c(t.debug,"setting bestDY {0} to {1}",l,i),l=i,$target=O(this))}}),$target}return b(s,n,t,e)}function x(i,e,n,t){c(n.debug,"__flxFindTargetInFrameV(<{0}>, {1})",i[0].nodeName,t);var s=i.parent();if(s.is("li"))return n.popup?t?s:s.next():t?(g(e),s):[];var o=1;t&&(o=-1);var l=e.offset();if($pFrameChildren=s.children().filter(function(){if(this==i[0])return c(n.debug,"remove element <{0}> from frame set",this.nodeName),!1;var e=O(this).offset().top;return!((e-l.top)*o<20)||(c(n.debug,"remove element <{0}> from frame set; top: {1} ",this.nodeName,e),!1)}),0<$pFrameChildren.length){var r=9999;return $target=[],$pFrameChildren.find("li").each(function(){var e=O(this).offset();if(c(n.debug,"compare <li> {0} with {1}",e,l),5<(e.top-l.top)*o){var i=Math.abs(l.top-e.top);i<r&&(c(n.debug,"setting bestDY {0} to {1}",r,i),r=i,$target=O(this))}}),$target}return x(s,e,n,t)}function n(e,i){var n,t=e.children(".menuFrame"),s=t.children(".menuSlider"),o=s.children(".flxMenu"),l=o[0].flxOptions;c(l.debug,'"menuShow" triggered'),$Li=o.find("li"),$Li.each(function(){O(this).hasClass("active")?((n=O(this).children("a")).prop("href")||n.prop("href","javascript:"),O(this).parentsUntil(".flxMenu","li").each(function(e){$parentLi=O(this),$parentLi.addClass("displaySubmenu"),$parentLi.children("ul, div").first().css("height","auto")})):m(O(this))}),i?function(e,i,n,t){var s="left",o="right";t==r.puRight&&(s="right",o="left");e.css("display","block"),n.puAligned?e.css(s,"100%"):e.css(s,0);e.css(o,"auto"),e.css("width",0),e.css("overflow","hidden"),i.css("position","fixed"),i.css(o,"auto"),i.css(s,-9999);var l=i.outerWidth()+3;n.puFullRange?(e.css("position","fixed"),e.css("height","100%"),i.css("height","100%")):e.css("height",i.outerHeight());c(n.debug,"flxPopupMoveInHoriz - menu w: {0}",l),i.css("position",""),i.css(s,0),i.css(o,"auto"),i.addClass("inProgrOpen"),e.animate({width:l},n.duration,function(){i.removeClass("inProgrOpen"),e.parent().addClass("showUp"),e.css("overflow","")})}(t,s,l,i):function(e,i,n){e.css("display","block"),n.puAligned?e.css("top","100%"):e.css("top",0);e.css("height",0),e.css("overflow","hidden"),i.css("position","fixed"),i.css("bottom","auto"),i.css("top",-9999);var t=i.outerHeight();c(n.debug,"flxPopupMoveInTop - menu calculated h: {0}",t),i.css("position",""),i.css("bottom",0),i.css("top","auto"),n.puFullRange?(n.puAligned||e.css("position","fixed"),e.css("left","0"),e.css("width","100%"),i.css("width","100%")):e.css("width",i.outerWidth());i.addClass("inProgrOpen"),e.animate({height:t},n.duration,function(){i.removeClass("inProgrOpen"),e.parent().addClass("showUp"),e.css("overflow",""),i.css("bottom","auto"),i.css("top",0)})}(t,s,l),t.parent().addClass("showUp"),n||(n=$Li.first().find("a:first")),c(l.debug,"try to set focus to {0}",n.text()),n.focus(),l.fnPopupShowing(!0,e)}function t(e,i){var n,t,s,o,l,r,a=e.children(".menuFrame"),u=a.children(".menuSlider"),f=u.children(".flxMenu")[0].flxOptions;c(f.debug,'"menuClose" triggered'),a.css("overflow","hidden"),i?(s=a,l=f,r=(o=u).outerWidth()+3,c(l.debug,"flxPopupMoveOutLeft - menu w: {0}",r),s.css("height",o.outerHeight()),s.animate({width:0},l.duration,function(){s.parent().removeClass("showUp"),s.css("display","none")})):(t=f,(n=a).animate({height:0},t.duration,function(){n.parent().removeClass("showUp"),n.css("display","none")})),e.removeClass("showUp"),e.children("a").first().focus(),f.fnPopupShowing(!1,e)}function w(e){n(O(this))}function $(e){n(O(this),r.puLeft)}function L(e){n(O(this),r.puRight)}function S(e){t(O(this),r.puLeft)}function k(e){t(O(this),r.puRight)}function y(e){t(O(this))}function F(e){e.flxOptions.popup&&(c(e.flxOptions.debug,"flxCalcTHW: temporarily changing to desktop mode"),O(e.initialFrame).prepend(e));var i=0;O(e).children("li").each(function(){i+=O(this).outerWidth(!0)}),e.flxOptions.thW=i+e.flxOptions.puAutoWidth,c(e.flxOptions.debug,'set thw to "{0}px"',e.flxOptions.thW)}c(!0,"flxMenu has already been applied")})}(jQuery);